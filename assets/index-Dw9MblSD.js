import{m as D,r,h as x,j as s,n as F,N as H,o as V,a as J,l as K,e as Q,f as X,g as w,p as e2,M as Y,q as s2,S as t2,s as a2}from"./index-HOmjZ3KE.js";const l2="data:image/svg+xml,%3csvg%20width='37'%20height='37'%20viewBox='0%200%2037%2037'%20fill='none'%20xmlns='http://www.w3.org/2000/svg'%3e%3ccircle%20cx='18.5'%20cy='18.5'%20r='18.5'%20fill='%23F1F4F9'/%3e%3cpath%20d='M23.25%2011H13.75C10.9%2011%209%2012.4118%209%2015.7059V22.2941C9%2025.5882%2010.9%2027%2013.75%2027H23.25C26.1%2027%2028%2025.5882%2028%2022.2941V15.7059C28%2012.4118%2026.1%2011%2023.25%2011ZM13.0375%2021.3529C13.0375%2021.7388%2012.7145%2022.0588%2012.325%2022.0588C11.9355%2022.0588%2011.6125%2021.7388%2011.6125%2021.3529V16.6471C11.6125%2016.2612%2011.9355%2015.9412%2012.325%2015.9412C12.7145%2015.9412%2013.0375%2016.2612%2013.0375%2016.6471V21.3529ZM18.5%2021.8235C16.923%2021.8235%2015.65%2020.5624%2015.65%2019C15.65%2017.4376%2016.923%2016.1765%2018.5%2016.1765C20.077%2016.1765%2021.35%2017.4376%2021.35%2019C21.35%2020.5624%2020.077%2021.8235%2018.5%2021.8235ZM25.3875%2021.3529C25.3875%2021.7388%2025.0645%2022.0588%2024.675%2022.0588C24.2855%2022.0588%2023.9625%2021.7388%2023.9625%2021.3529V16.6471C23.9625%2016.2612%2024.2855%2015.9412%2024.675%2015.9412C25.0645%2015.9412%2025.3875%2016.2612%2025.3875%2016.6471V21.3529Z'%20fill='%233982A7'/%3e%3c/svg%3e",n2="data:image/svg+xml,%3csvg%20width='37'%20height='37'%20viewBox='0%200%2037%2037'%20fill='none'%20xmlns='http://www.w3.org/2000/svg'%3e%3ccircle%20cx='18.5'%20cy='18.5'%20r='18.5'%20fill='%23F1F4F9'/%3e%3cpath%20fill-rule='evenodd'%20clip-rule='evenodd'%20d='M13%2012C13%2011.4477%2013.4477%2011%2014%2011H24C24.5523%2011%2025%2011.4477%2025%2012V26C25%2026.5523%2024.5523%2027%2024%2027H23.4142C23.149%2027%2022.8946%2026.8946%2022.7071%2026.7071L21.7071%2025.7071C21.3166%2025.3166%2020.6834%2025.3166%2020.2929%2025.7071L19.7071%2026.2929C19.3166%2026.6834%2018.6834%2026.6834%2018.2929%2026.2929L17.7071%2025.7071C17.3166%2025.3166%2016.6834%2025.3166%2016.2929%2025.7071L15.2929%2026.7071C15.1054%2026.8946%2014.851%2027%2014.5858%2027H14C13.4477%2027%2013%2026.5523%2013%2026V12ZM16%2016C16%2015.4477%2016.4477%2015%2017%2015H21C21.5523%2015%2022%2015.4477%2022%2016C22%2016.5523%2021.5523%2017%2021%2017H17C16.4477%2017%2016%2016.5523%2016%2016ZM22%2020C22%2019.4477%2021.5523%2019%2021%2019H17C16.4477%2019%2016%2019.4477%2016%2020C16%2020.5523%2016.4477%2021%2017%2021H21C21.5523%2021%2022%2020.5523%2022%2020Z'%20fill='%233982A7'/%3e%3c/svg%3e",i2="data:image/svg+xml,%3csvg%20width='37'%20height='37'%20viewBox='0%200%2037%2037'%20fill='none'%20xmlns='http://www.w3.org/2000/svg'%3e%3ccircle%20cx='18.5'%20cy='18.5'%20r='18.5'%20fill='%23F1F4F9'/%3e%3cpath%20fill-rule='evenodd'%20clip-rule='evenodd'%20d='M15.8889%2011.3304V12.2174H14.7333C14.5057%2012.2174%2014.2803%2012.2633%2014.07%2012.3524C13.8597%2012.4416%2013.6686%2012.5722%2013.5077%2012.737C13.3467%2012.9017%2013.2191%2013.0972%2013.1319%2013.3125C13.0448%2013.5277%2013%2013.7584%2013%2013.9913V25.2261C13%2025.6966%2013.1826%2026.1478%2013.5077%2026.4804C13.6686%2026.6452%2013.8597%2026.7758%2014.07%2026.865C14.2803%2026.9541%2014.5057%2027%2014.7333%2027H24.2667C24.7264%2027%2025.1673%2026.8131%2025.4923%2026.4804C25.8174%2026.1478%2026%2025.6966%2026%2025.2261V13.9913C26%2013.5208%2025.8174%2013.0696%2025.4923%2012.737C25.1673%2012.4043%2024.7264%2012.2174%2024.2667%2012.2174H23.1111V11.3304C23.1111%2010.9776%2022.9741%2010.6392%2022.7303%2010.3897C22.4866%2010.1402%2022.1559%2010%2021.8111%2010H17.1889C16.8441%2010%2016.5134%2010.1402%2016.2696%2010.3897C16.0259%2010.6392%2015.8889%2010.9776%2015.8889%2011.3304ZM21.6667%2011.4783H17.3333V12.9565H21.6667V11.4783ZM22.9768%2017.8207C23.0319%2017.7417%2023.0712%2017.6524%2023.0926%2017.5578C23.114%2017.4632%2023.1169%2017.3653%2023.1013%2017.2695C23.0857%2017.1738%2023.0518%2017.0821%2023.0015%2016.9998C22.9513%2016.9175%2022.8857%2016.846%2022.8085%2016.7897C22.7313%2016.7333%2022.644%2016.693%2022.5516%2016.6711C22.4592%2016.6492%2022.3635%2016.6462%2022.2699%2016.6622C22.1763%2016.6782%2022.0868%2016.7129%2022.0063%2016.7643C21.9259%2016.8157%2021.8561%2016.8829%2021.801%2016.9619L18.6853%2021.4262L17.1217%2019.8253C16.9855%2019.6906%2016.8031%2019.6161%2016.6137%2019.6178C16.4243%2019.6195%2016.2432%2019.6972%2016.1093%2019.8343C15.9754%2019.9713%2015.8994%2020.1567%2015.8978%2020.3505C15.8961%2020.5443%2015.9689%2020.731%2016.1005%2020.8704L18.2672%2023.0878C18.3413%2023.1636%2018.4307%2023.2219%2018.5292%2023.2588C18.6276%2023.2957%2018.7327%2023.3102%2018.8371%2023.3013C18.9416%2023.2925%2019.0429%2023.2605%2019.134%2023.2075C19.2252%2023.1545%2019.304%2023.0819%2019.3649%2022.9947L22.9768%2017.8207Z'%20fill='%233982A7'/%3e%3c/svg%3e",P=[{value:1,label:"BORROWED",className:"borrowed"},{value:2,label:"RETURNED",className:"returned"},{value:3,label:"OVERDUE",className:"overdue"},{value:4,label:"MISSING",className:"missing"}],o2=g=>P.find(i=>i.value===g)??{},c2=({showModal:g,closeModal:i,data:l})=>{console.log(" data",l);const{getTransactions:v,transactions:o,isRentalLoading:p}=D(n=>n);console.log(" transactions",o),r.useEffect(()=>{l&&v({id:l["inventory.eZPassNumber"],borrowedAt:x(l.borrowedAt).format("YYYY-MM-DD"),returnedAt:x(l.returnedAt).format("YYYY-MM-DD")})},[l]);const m=[{name:"Transaction Date",selector:"transactionDate",sortable:!0},{name:"Tag/Plate Number",selector:"tagPlateNumber",sortable:!0},{name:"Agency",selector:"agency",sortable:!0},{name:"Plaza Id",selector:"plazaId",sortable:!0},{name:"Entry Time",selector:"entryTime",sortable:!0},{name:"Amount",selector:"amount",sortable:!0}],h=n=>n?x.utc(n).format("MMM D, YYYY : hh:mm A"):"-",u=()=>s.jsxs("div",{className:"modal-body",children:[s.jsxs("div",{class:"info-round-wrp",children:[s.jsxs("div",{class:"info-round-blks",children:[s.jsx("div",{class:"box-title",children:"Borrowed date and time"}),s.jsx("div",{class:"box-value",children:h(l.borrowedAt)})]}),s.jsxs("div",{class:"info-round-blks",children:[s.jsx("div",{class:"box-title",children:"Returned date and time"}),s.jsx("div",{class:"box-value",children:h(l.returnedAt)})]}),s.jsxs("div",{class:"info-round-blks",children:[s.jsx("div",{class:"box-title",children:"Balance Due"}),s.jsxs("div",{class:"box-value",children:["$",l.balanceDue]})]})]}),s.jsx("div",{class:"table-wrap table-responsive",children:p?s.jsx(V,{columns:m,limit:10}):o!=null&&o.length?s.jsxs("table",{class:"table",children:[s.jsx("thead",{children:s.jsxs("tr",{children:[s.jsx("th",{class:"th-date",children:"Transaction Date"}),s.jsx("th",{class:"th-tag",children:"Tag/Plate Number"}),s.jsx("th",{class:"th-agency",children:"Agency"}),s.jsx("th",{class:"th-id",children:"Plaza Id"}),s.jsx("th",{class:"th-time",children:"Entry Time"}),s.jsx("th",{class:"th-amount",children:"Amount"})]})}),s.jsx("tbody",{children:o.map((n,A)=>s.jsxs("tr",{children:[s.jsx("td",{children:x(n.transactionDate).format("MMM D, YYYY")}),s.jsx("td",{children:n.tagPlateNumber}),s.jsx("td",{children:n.agency}),s.jsx("td",{children:n.plazaId}),s.jsx("td",{children:x(n.entryTime,"HH:mm:ss").format("hh:mm A")}),s.jsxs("td",{children:["$",n.amount]})]},`row${A+n.id}`))})]}):s.jsx(H,{columns:m})})]});return s.jsx(F,{closeButton:!0,className:"modal fade transaction-view-modal",dialgName:"modal-dialog modal-dialog-centered modal-dialog-scrollable",show:g,closeModal:i,header:s.jsx("h5",{className:"modal-title",id:"uploadModalLabel",children:"View Transactions"}),contentClassName:"modal-content",body:u()})},d2=({showModal:g,closeModal:i,data:l})=>{const{getBillingHistory:v,billingHistory:o,isRentalLoading:p}=D(u=>u);r.useEffect(()=>{l&&v({userId:l["user.id"]})},[l]);const m=[{name:"Amount",selector:"amount",sortable:!0},{name:"Charged Date",selector:"chargedDate",sortable:!0}],h=()=>s.jsxs("div",{className:"modal-body",children:[s.jsxs("div",{class:"info-round-wrp",children:[s.jsxs("div",{class:"info-round-blks",children:[s.jsx("div",{class:"box-title",children:"User Name"}),s.jsxs("div",{class:"box-value",children:[l["user.firstName"]+" "+l["user.lastName"]," "]})]}),s.jsxs("div",{class:"info-round-blks",children:[s.jsx("div",{class:"box-title",children:"Total Charged"}),s.jsxs("div",{class:"box-value",children:["$",parseFloat(l.totalDue).toFixed(2)]})]})]}),s.jsx("div",{class:"table-wrap table-responsive",children:p?s.jsx(V,{columns:m,limit:5}):o!=null&&o.length?s.jsxs("table",{class:"table",children:[s.jsx("thead",{children:s.jsxs("tr",{children:[s.jsx("th",{class:"th-date",children:"Amount"}),s.jsx("th",{class:"th-tag",children:"Charged Date"})]})}),s.jsx("tbody",{children:o==null?void 0:o.map((u,n)=>s.jsxs("tr",{children:[s.jsxs("td",{children:["$",parseFloat(u.totalAmount).toFixed(2)]}),s.jsx("td",{children:x(u.chargedDate).format("MMM D, YYYY")})]},u.id+n))})]}):s.jsx(H,{columns:m})})]});return s.jsx(F,{closeButton:!0,className:"modal fade transaction-view-modal",dialgName:"modal-dialog modal-dialog-centered modal-dialog-scrollable",show:g,closeModal:i,header:s.jsx("h5",{className:"modal-title",id:"uploadModalLabel",children:"Billing History"}),contentClassName:"modal-content",body:h()})},m2=()=>{var R,T;const{getAllRentals:g,rentalData:i,isRentalLoading:l,exportRental:v,isExportLoading:o,changeStatus:p,successMessage:m,statusLoading:h,uploadEzPass:u,userActionLoading:n}=D(e=>e),{getAllUsersListByRole:A,usersRoleData:E}=J(e=>e),[N,b]=r.useState({}),[t,C]=r.useState(null),B={page:1,limit:10,search:"",sortOrder:"DESC",isEzPass:!0},[f,j]=r.useState(B),S=r.useRef(null);r.useEffect(()=>{const e=a=>{S.current&&!S.current.contains(a.target)&&b({})};return document.addEventListener("mousedown",e),()=>{document.removeEventListener("mousedown",e)}},[]),r.useEffect(()=>{m&&(L(),b({}),D.setState({successMessage:""}))},[m]),r.useEffect(()=>{A({role:2})},[]);const L=()=>{g(f)},k=e=>{j(a=>({...a,sortBy:e,sortOrder:a.sortOrder==="ASC"?"DESC":"ASC"}))},O=e=>{j(a=>({...a,page:e}))},I=e=>{j(a=>({...a,limit:e}))};r.useEffect(()=>{L()},[f]);const $=K.debounce(e=>{j(a=>({...a,search:e,page:1}))},500),y=e=>e?x.utc(e).format("MMM D, YYYY : hh:mm A"):"-",Z=e=>{const{label:a,className:c}=o2(e.status);if(N.id===e.id){const d=()=>{if(e.status===N.status){b({});return}p({id:N.id,status:N.status})};return s.jsxs("div",{className:"loan-status-wrp",ref:S,children:[s.jsx(s2,{classNamePrefix:"react-select",isClearable:!1,options:P,value:e.status,onChange:({value:M})=>b(q=>({...q,status:M}))}),s.jsx("button",{onClick:d,className:"btn-save-trans",disabled:h,children:h?s.jsx(t2,{size:"sm",as:"span",animation:"border",variant:"light","aria-hidden":"true",className:"custom-spinner"}):"Save"})]})}return s.jsx(s.Fragment,{children:s.jsx("div",{className:"d-flex justify-content-center",children:s.jsxs("span",{className:`status-wrap ${c} cursor-pointer`,onClick:()=>{b({id:e.id,status:e.status})},children:[s.jsx("span",{children:a})," ",!e.isOld&&s.jsx("img",{style:{cursor:"pointer"},src:a2,alt:"edit-icon",className:"flex-shrink-0",onClick:()=>{b({id:e.id,status:e.status})}})]})})})},U=[{name:"User",selector:"user.firstName",titleClasses:"tw1",contentClass:"user-pic",cell:e=>s.jsxs(s.Fragment,{children:[s.jsx(e2,{name:`${(e==null?void 0:e["user.firstName"])||""} ${(e==null?void 0:e["user.lastName"])||""}`.trim()}),s.jsx("span",{children:e!=null&&e["user.firstName"]||e!=null&&e["user.lastName"]?`${e==null?void 0:e["user.firstName"]} ${e==null?void 0:e["user.lastName"]}`:"-"})]})},{name:"EZ pass item ID",selector:"inventory.itemId",titleClasses:"tw2"},{name:"Item Name",selector:"inventory.itemName",titleClasses:"tw3"},{name:"Borrowed On",selector:"borrowedAt",cell:e=>y(e==null?void 0:e.borrowedAt),titleClasses:"tw4"},{name:"Deadline",selector:"dueDate",cell:e=>y(e==null?void 0:e.dueDate),titleClasses:"tw5"},{name:"Returned date and time",selector:"returnedAt",cell:e=>(e==null?void 0:e.dueDate)<(e==null?void 0:e.returnedAt)?s.jsx("span",{className:"text-danger",children:y(e==null?void 0:e.returnedAt)}):y(e==null?void 0:e.returnedAt),titleClasses:"tw6"},{name:"Loan Status",selector:"status",titleClasses:"tw6",cell:e=>Z(e)},{name:"Balance Due",selector:"balanceDue",titleClasses:"tw6",colClassName:"balance-due",cell:e=>`$${e!=null&&e.balanceDue?parseFloat(e.balanceDue).toFixed(2):0}`},{name:"Total Due",selector:"totalDue",colClassName:"balance-due",cell:e=>`$${e!=null&&e.totalDue?parseFloat(e.totalDue).toFixed(2):0}`},{name:"Action",selector:"action",titleClasses:"tw7",contentClass:"action-wrap",cell:e=>s.jsxs(s.Fragment,{children:[e.status==2&&s.jsx("img",{src:l2,alt:"Note","data-tooltip-id":"note-tooltip","data-tooltip-content":"View Billing History",onClick:()=>{C({data:e,mode:"history"})}}),e.status==2&&s.jsx("img",{src:n2,alt:"Alert","data-tooltip-id":"alert-tooltip","data-tooltip-content":"View Transactions",onClick:()=>{C({data:e,mode:"transaction"})}}),e.balanceDue!=0&&s.jsx("img",{src:i2,alt:"shopping-bag",onClick:()=>{C({data:e,mode:"warning"})},"data-tooltip-id":"deadline-tooltip","data-tooltip-content":"Charge Balance"}),s.jsx(Y,{id:"note-tooltip",place:"bottom",effect:"solid",style:{backgroundColor:"#051a53"}}),s.jsx(Y,{id:"alert-tooltip",place:"bottom",effect:"solid",style:{backgroundColor:"#051a53"}}),s.jsx(Y,{id:"deadline-tooltip",place:"bottom",effect:"solid",style:{backgroundColor:"#051a53"}})]})}],z=async()=>{v({...f,fileName:"EZpass_data"})},_=[{fieldName:"Borrowed Date",BE_keyName:"borrowedAt",fieldType:"dateRange"},{fieldName:"Deadline Date",BE_keyName:"deadline_date",fieldType:"dateRange"},{fieldName:"Returned Date",BE_keyName:"returnedAt",fieldType:"dateRange"},{fieldName:"Rental Status",BE_keyName:"status",fieldType:"select",Options:[{label:"Borrowed",value:1},{label:"Returned",value:2},{label:"Overdue",value:3},{label:"Missing",value:4}]},{fieldName:"User",BE_keyName:"user",fieldType:"select",isMulti:!0,Options:(()=>{var e,a;return(a=(e=E==null?void 0:E.data)==null?void 0:e.map(({id:c,firstName:d})=>({value:c,label:d})))==null?void 0:a.sort((c,d)=>{var M;return(M=c.label)==null?void 0:M.localeCompare(d.label)})})()}],W=e=>{const a={};Object.entries(e).forEach(([c,d])=>{(c.endsWith("_start")||c.endsWith("_end"))&&d?a[c]=x(d).format("YYYY-MM-DD"):c==="user"&&Array.isArray(d)?a[c]=d.filter(Boolean):a[c]=d}),j({...f,...a,page:"1"})},G=()=>s.jsx(w,{closeModal:()=>C(null),isLoading:h,message:`Are you sure you want to charge amount of $${t==null?void 0:t.data.balanceDue} for this user?`,button:{primary:"Yes",secondary:"No"},onSubmit:()=>{p({id:t==null?void 0:t.data.id,balanceDue:t==null?void 0:t.data.balanceDue}),C(null)},showModal:(t==null?void 0:t.mode)==="warning",isWarning:!0});return s.jsxs(s.Fragment,{children:[G(),s.jsx(Q,{onSearch:$,exportExcel:(R=i==null?void 0:i.data)!=null&&R.length?z:null,exportLoading:o,filterOptions:_,submitFilter:W,clearOptions:()=>{j(B)},type:"ezpass",uploadExcel:!0,onExcelUpload:e=>u(e),uploadTitle:"Import EZ Pass",uploadLoading:n}),s.jsx(X,{pagination:{currentPage:f.page,limit:f.limit},count:(T=i==null?void 0:i.pagination)==null?void 0:T.totalPages,columns:U,data:(i==null?void 0:i.data)||[],isLoading:l,onPageChange:O,setLimit:I,onSortChange:k,wrapClasses:"ezpass-table-wrap"}),(t==null?void 0:t.mode)==="transaction"&&s.jsx(c2,{showModal:!!t,closeModal:()=>C(null),data:t.data}),(t==null?void 0:t.mode)==="history"&&s.jsx(d2,{showModal:!!t,closeModal:()=>C(null),data:t.data})]})};export{m2 as default};
