import{t as F,v as O,w as Z,G as U,x as W,y as L,r as c,j as r,n as J,S as Y,C as P,p as B,z as $,i as Q,M as X,R as I,e as C,g as ee,A as G,B as se}from"./index-Cnxfy8I7.js";function V(e){return F(e,Date.now())}function ie(e,l){return O(F(e,e),V(e))}function re(e,l){return O(F(e,e),Z(V(e)))}const ne="data:image/svg+xml,%3csvg%20width='34'%20height='34'%20viewBox='0%200%2034%2034'%20fill='none'%20xmlns='http://www.w3.org/2000/svg'%3e%3cpath%20d='M17.0007%200.333008C7.81732%200.333008%200.333984%207.81634%200.333984%2016.9997C0.333984%2026.183%207.81732%2033.6663%2017.0007%2033.6663C26.184%2033.6663%2033.6673%2026.183%2033.6673%2016.9997C33.6673%207.81634%2026.184%200.333008%2017.0007%200.333008ZM23.6673%2018.2497H18.2507V23.6663C18.2507%2024.3497%2017.684%2024.9163%2017.0007%2024.9163C16.3173%2024.9163%2015.7507%2024.3497%2015.7507%2023.6663V18.2497H10.334C9.65065%2018.2497%209.08398%2017.683%209.08398%2016.9997C9.08398%2016.3163%209.65065%2015.7497%2010.334%2015.7497H15.7507V10.333C15.7507%209.64967%2016.3173%209.08301%2017.0007%209.08301C17.684%209.08301%2018.2507%209.64967%2018.2507%2010.333V15.7497H23.6673C24.3507%2015.7497%2024.9173%2016.3163%2024.9173%2016.9997C24.9173%2017.683%2024.3507%2018.2497%2023.6673%2018.2497Z'%20fill='%23051a53'/%3e%3c/svg%3e",te=()=>U.get("/conversation/all-users"),ae=e=>U.post("/conversation",e),oe=e=>U.delete(`/conversation/${e}`),le=e=>U.get("/conversation",{params:e}),he=e=>U.post("/message",e),de=(e,l)=>U.get(`/conversation/${e}`,{params:l}),A={getAllContacts:te,addUsers:ae,getUsers:le,postMessage:he,deleteUser:oe,GetMessageById:de},H=W(e=>({isLoadingContact:!1,isLoadingAddUser:!1,loadingSelectedUsers:!1,errorMessage:"",successMessage:"",contacts:null,selectedUsers:null,isLoadingPostMessage:!1,usersTotalCount:null,messageIdData:null,getAllContacts:async()=>{var l,i,s,n,t,d,f;try{e({isLoadingContact:!0});const{data:m}=await A.getAllContacts();e({contacts:(l=m.data)==null?void 0:l.data,successMessage:((s=(i=m==null?void 0:m.response)==null?void 0:i.data)==null?void 0:s.message)??(m==null?void 0:m.message),isLoadingContact:!1})}catch(m){const{error:a}=L.getState();e({errorMessage:((t=(n=m==null?void 0:m.response)==null?void 0:n.data)==null?void 0:t.message)??(m==null?void 0:m.message),isLoadingContact:!1}),a(((f=(d=m==null?void 0:m.response)==null?void 0:d.data)==null?void 0:f.message)??m.message)}},addUsers:async(l,i)=>{var s,n,t,d,f,m,a,u;try{e({isLoadingAddUser:!0});const{data:o}=await A.addUsers(l),{success:j}=L.getState();j(((n=(s=o==null?void 0:o.response)==null?void 0:s.data)==null?void 0:n.message)??(o==null?void 0:o.message)),e({successMessage:((d=(t=o==null?void 0:o.response)==null?void 0:t.data)==null?void 0:d.message)??(o==null?void 0:o.message),isLoadingAddUser:!1}),i&&i()}catch(o){const{error:j}=L.getState();e({errorMessage:((m=(f=o==null?void 0:o.response)==null?void 0:f.data)==null?void 0:m.message)??(o==null?void 0:o.message),isLoadingAddUser:!1}),j(((u=(a=o==null?void 0:o.response)==null?void 0:a.data)==null?void 0:u.message)??o.message)}},deleteUser:async({id:l},i)=>{var s,n,t,d,f,m,a,u;try{e({isLoadingDelete:!0});const{data:o}=await A.deleteUser(l),{success:j}=L.getState();j(((n=(s=o==null?void 0:o.response)==null?void 0:s.data)==null?void 0:n.message)??(o==null?void 0:o.message)),e({successMessage:((d=(t=o==null?void 0:o.response)==null?void 0:t.data)==null?void 0:d.message)??(o==null?void 0:o.message),isLoadingDelete:!1}),i&&i()}catch(o){const{error:j}=L.getState();e({errorMessage:((m=(f=o==null?void 0:o.response)==null?void 0:f.data)==null?void 0:m.message)??(o==null?void 0:o.message),isLoadingDelete:!1}),j(((u=(a=o==null?void 0:o.response)==null?void 0:a.data)==null?void 0:u.message)??o.message)}},getSelectedUsers:async l=>{var i,s,n,t,d,f,m,a;try{e({loadingSelectedUsers:!0});const{data:u}=await A.getUsers(l);e({selectedUsers:(i=u.data)==null?void 0:i.data,successMessage:((n=(s=u==null?void 0:u.response)==null?void 0:s.data)==null?void 0:n.message)??(u==null?void 0:u.message),loadingSelectedUsers:!1,usersTotalCount:(t=u==null?void 0:u.data)==null?void 0:t.total})}catch(u){const{error:o}=L.getState();e({errorMessage:((f=(d=u==null?void 0:u.response)==null?void 0:d.data)==null?void 0:f.message)??(u==null?void 0:u.message),loadingSelectedUsers:!1}),o(((a=(m=u==null?void 0:u.response)==null?void 0:m.data)==null?void 0:a.message)??u.message)}},GetMessageById:async(l,i)=>{var s,n,t,d,f,m;try{e({loadingMessageById:!0});const{data:a}=await A.GetMessageById(l,i);e({messageIdData:a.data,successMessage:((n=(s=a==null?void 0:a.response)==null?void 0:s.data)==null?void 0:n.message)??(a==null?void 0:a.message),loadingMessageById:!1})}catch(a){const{error:u}=L.getState();e({errorMessage:((d=(t=a==null?void 0:a.response)==null?void 0:t.data)==null?void 0:d.message)??(a==null?void 0:a.message),loadingMessageById:!1}),u(((m=(f=a==null?void 0:a.response)==null?void 0:f.data)==null?void 0:m.message)??a.message)}},postMessage:async(l,i)=>{var s,n,t,d,f,m;try{e({isLoadingPostMessage:!0});const{data:a}=await A.postMessage(l);e({successMessage:((n=(s=a==null?void 0:a.response)==null?void 0:s.data)==null?void 0:n.message)??(a==null?void 0:a.message),isLoadingPostMessage:!1}),i&&i()}catch(a){const{error:u}=L.getState();e({errorMessage:((d=(t=a==null?void 0:a.response)==null?void 0:t.data)==null?void 0:d.message)??(a==null?void 0:a.message),isLoadingPostMessage:!1}),u(((m=(f=a==null?void 0:a.response)==null?void 0:f.data)==null?void 0:m.message)??a.message)}}})),me=({showModal:e,closeModal:l,contacts:i=[],selectedUsers:s=[],onAdded:n,colorMap:t})=>{const[d,f]=c.useState([]),[m,a]=c.useState(""),{addUsers:u,isLoadingAddUser:o,isLoadingContact:j}=H(h=>h),T=c.useMemo(()=>s==null?void 0:s.map(h=>h==null?void 0:h.userId),[s]),N=c.useMemo(()=>i==null?void 0:i.filter(h=>!(T!=null&&T.includes(h.id))),[i,T]),p=h=>{a(""),f(x=>x!=null&&x.includes(h)?x==null?void 0:x.filter(y=>y!==h):[...x,h])},E=()=>{d.length>0?u({userId:d},()=>{n==null||n(),f([]),a(""),l()}):a("Please select at least one contact.")};return r.jsx(J,{closeButton:!0,className:"modal fade add-new-msg-modal",dialgName:"modal-dialog modal-dialog-centered modal-dialog-scrollable",show:e,closeModal:()=>{f([]),a(""),l()},header:r.jsx("h5",{className:"modal-title",children:"Create Message"}),body:r.jsxs("div",{className:"modal-body",children:[j?r.jsx(r.Fragment,{children:Array.from({length:10}).map((h,x)=>r.jsx(P,{},x))}):(N==null?void 0:N.length)===0?r.jsx("div",{className:"no-results",children:"No users found."}):r.jsx("ul",{className:"msg-list-wrp",children:N==null?void 0:N.map(h=>r.jsxs("li",{className:`msg-list ${d!=null&&d.includes(h==null?void 0:h.id)?"selected":""}`,onClick:()=>p(h==null?void 0:h.id),style:{cursor:"pointer",backgroundColor:d.includes(h==null?void 0:h.id)?"#e6f7ff":"transparent"},children:[r.jsx("div",{className:"prof-img",children:r.jsx(B,{name:h==null?void 0:h.name,uniqueKey:h==null?void 0:h.id,colorClass:t==null?void 0:t[h==null?void 0:h.id]})}),r.jsxs("div",{className:"prof-dtl",children:[r.jsx("div",{className:"info",children:r.jsx("div",{className:"name",children:h==null?void 0:h.name})}),r.jsx("div",{className:"time",children:h==null?void 0:h.time})]})]},h==null?void 0:h.id))}),m&&r.jsx("span",{className:"error",children:m})]}),footer:r.jsx("div",{className:"modal-footer",children:r.jsx("button",{className:"btn btn-primary",onClick:E,disabled:o,children:r.jsx("span",{className:"icon",children:o?r.jsx(Y,{size:"sm",as:"span",animation:"border",variant:"light","aria-hidden":"true",className:"custom-spinner"}):"Add"})})})})},ue=(e,l=6e4)=>{const[i,s]=c.useState($(e));return c.useEffect(()=>{const n=()=>s($(e)),t=setInterval(n,l);return n(),()=>clearInterval(t)},[e,l]),i},ge=({contact:e,selectedId:l,onSelectContact:i,colorMap:s,onDelete:n})=>{const t=[...(e==null?void 0:e.messages)||[]].sort((f,m)=>new Date(m.createdAt)-new Date(f.createdAt))[0],d=ue(t==null?void 0:t.createdAt);return r.jsxs("li",{className:l===(e==null?void 0:e.id)?"active":"",onClick:()=>i(e.id),children:[r.jsx(B,{name:e==null?void 0:e.name,uniqueKey:e==null?void 0:e.id,colorClass:s==null?void 0:s[e==null?void 0:e.id]}),r.jsxs("div",{className:"name-msg-wrap",children:[r.jsx("div",{className:"name",children:e==null?void 0:e.name}),r.jsx("div",{className:"msg",children:(t==null?void 0:t.message)||"No messages yet"})]}),r.jsx("div",{className:"time",children:d}),l===(e==null?void 0:e.id)&&r.jsx("img",{src:Q,alt:"Delete","data-tooltip-id":`delete-tooltip-${e==null?void 0:e.id}`,"data-tooltip-content":"Delete",className:"cursor-pointer",onClick:f=>{f.stopPropagation(),n(e)}}),r.jsx(X,{id:`delete-tooltip-${e==null?void 0:e.id}`,place:"top",effect:"solid",style:{backgroundColor:"#051a53"}})]},e==null?void 0:e.id)};/*! *****************************************************************************
Copyright (c) Microsoft Corporation. All rights reserved.
Licensed under the Apache License, Version 2.0 (the "License"); you may not use
this file except in compliance with the License. You may obtain a copy of the
License at http://www.apache.org/licenses/LICENSE-2.0

THIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED
WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,
MERCHANTABLITY OR NON-INFRINGEMENT.

See the Apache Version 2.0 License for specific language governing permissions
and limitations under the License.
***************************************************************************** */var k=function(e,l){return k=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(i,s){i.__proto__=s}||function(i,s){for(var n in s)s.hasOwnProperty(n)&&(i[n]=s[n])},k(e,l)};function fe(e,l){k(e,l);function i(){this.constructor=e}e.prototype=l===null?Object.create(l):(i.prototype=l.prototype,new i)}var R=function(){return R=Object.assign||function(l){for(var i,s=1,n=arguments.length;s<n;s++){i=arguments[s];for(var t in i)Object.prototype.hasOwnProperty.call(i,t)&&(l[t]=i[t])}return l},R.apply(this,arguments)};function pe(e,l,i,s){var n,t=!1,d=0;function f(){n&&clearTimeout(n)}function m(){f(),t=!0}typeof l!="boolean"&&(s=i,i=l,l=void 0);function a(){var u=this,o=Date.now()-d,j=arguments;if(t)return;function T(){d=Date.now(),i.apply(u,j)}function N(){n=void 0}s&&!n&&T(),f(),s===void 0&&o>e?T():l!==!0&&(n=setTimeout(s?N:T,s===void 0?e-o:e))}return a.cancel=m,a}var _={Pixel:"Pixel",Percent:"Percent"},q={unit:_.Percent,value:.8};function K(e){return typeof e=="number"?{unit:_.Percent,value:e*100}:typeof e=="string"?e.match(/^(\d*(\.\d+)?)px$/)?{unit:_.Pixel,value:parseFloat(e)}:e.match(/^(\d*(\.\d+)?)%$/)?{unit:_.Percent,value:parseFloat(e)}:(console.warn('scrollThreshold format is invalid. Valid formats: "120px", "50%"...'),q):(console.warn("scrollThreshold should be string or number"),q)}var z=(function(e){fe(l,e);function l(i){var s=e.call(this,i)||this;return s.lastScrollTop=0,s.actionTriggered=!1,s.startY=0,s.currentY=0,s.dragging=!1,s.maxPullDownDistance=0,s.getScrollableTarget=function(){return s.props.scrollableTarget instanceof HTMLElement?s.props.scrollableTarget:typeof s.props.scrollableTarget=="string"?document.getElementById(s.props.scrollableTarget):(s.props.scrollableTarget===null&&console.warn(`You are trying to pass scrollableTarget but it is null. This might
        happen because the element may not have been added to DOM yet.
        See https://github.com/ankeetmaini/react-infinite-scroll-component/issues/59 for more info.
      `),null)},s.onStart=function(n){s.lastScrollTop||(s.dragging=!0,n instanceof MouseEvent?s.startY=n.pageY:n instanceof TouchEvent&&(s.startY=n.touches[0].pageY),s.currentY=s.startY,s._infScroll&&(s._infScroll.style.willChange="transform",s._infScroll.style.transition="transform 0.2s cubic-bezier(0,0,0.31,1)"))},s.onMove=function(n){s.dragging&&(n instanceof MouseEvent?s.currentY=n.pageY:n instanceof TouchEvent&&(s.currentY=n.touches[0].pageY),!(s.currentY<s.startY)&&(s.currentY-s.startY>=Number(s.props.pullDownToRefreshThreshold)&&s.setState({pullToRefreshThresholdBreached:!0}),!(s.currentY-s.startY>s.maxPullDownDistance*1.5)&&s._infScroll&&(s._infScroll.style.overflow="visible",s._infScroll.style.transform="translate3d(0px, "+(s.currentY-s.startY)+"px, 0px)")))},s.onEnd=function(){s.startY=0,s.currentY=0,s.dragging=!1,s.state.pullToRefreshThresholdBreached&&(s.props.refreshFunction&&s.props.refreshFunction(),s.setState({pullToRefreshThresholdBreached:!1})),requestAnimationFrame(function(){s._infScroll&&(s._infScroll.style.overflow="auto",s._infScroll.style.transform="none",s._infScroll.style.willChange="unset")})},s.onScrollListener=function(n){typeof s.props.onScroll=="function"&&setTimeout(function(){return s.props.onScroll&&s.props.onScroll(n)},0);var t=s.props.height||s._scrollableNode?n.target:document.documentElement.scrollTop?document.documentElement:document.body;if(!s.actionTriggered){var d=s.props.inverse?s.isElementAtTop(t,s.props.scrollThreshold):s.isElementAtBottom(t,s.props.scrollThreshold);d&&s.props.hasMore&&(s.actionTriggered=!0,s.setState({showLoader:!0}),s.props.next&&s.props.next()),s.lastScrollTop=t.scrollTop}},s.state={showLoader:!1,pullToRefreshThresholdBreached:!1,prevDataLength:i.dataLength},s.throttledOnScrollListener=pe(150,s.onScrollListener).bind(s),s.onStart=s.onStart.bind(s),s.onMove=s.onMove.bind(s),s.onEnd=s.onEnd.bind(s),s}return l.prototype.componentDidMount=function(){if(typeof this.props.dataLength>"u")throw new Error('mandatory prop "dataLength" is missing. The prop is needed when loading more content. Check README.md for usage');if(this._scrollableNode=this.getScrollableTarget(),this.el=this.props.height?this._infScroll:this._scrollableNode||window,this.el&&this.el.addEventListener("scroll",this.throttledOnScrollListener),typeof this.props.initialScrollY=="number"&&this.el&&this.el instanceof HTMLElement&&this.el.scrollHeight>this.props.initialScrollY&&this.el.scrollTo(0,this.props.initialScrollY),this.props.pullDownToRefresh&&this.el&&(this.el.addEventListener("touchstart",this.onStart),this.el.addEventListener("touchmove",this.onMove),this.el.addEventListener("touchend",this.onEnd),this.el.addEventListener("mousedown",this.onStart),this.el.addEventListener("mousemove",this.onMove),this.el.addEventListener("mouseup",this.onEnd),this.maxPullDownDistance=this._pullDown&&this._pullDown.firstChild&&this._pullDown.firstChild.getBoundingClientRect().height||0,this.forceUpdate(),typeof this.props.refreshFunction!="function"))throw new Error(`Mandatory prop "refreshFunction" missing.
          Pull Down To Refresh functionality will not work
          as expected. Check README.md for usage'`)},l.prototype.componentWillUnmount=function(){this.el&&(this.el.removeEventListener("scroll",this.throttledOnScrollListener),this.props.pullDownToRefresh&&(this.el.removeEventListener("touchstart",this.onStart),this.el.removeEventListener("touchmove",this.onMove),this.el.removeEventListener("touchend",this.onEnd),this.el.removeEventListener("mousedown",this.onStart),this.el.removeEventListener("mousemove",this.onMove),this.el.removeEventListener("mouseup",this.onEnd)))},l.prototype.componentDidUpdate=function(i){this.props.dataLength!==i.dataLength&&(this.actionTriggered=!1,this.setState({showLoader:!1}))},l.getDerivedStateFromProps=function(i,s){var n=i.dataLength!==s.prevDataLength;return n?R(R({},s),{prevDataLength:i.dataLength}):null},l.prototype.isElementAtTop=function(i,s){s===void 0&&(s=.8);var n=i===document.body||i===document.documentElement?window.screen.availHeight:i.clientHeight,t=K(s);return t.unit===_.Pixel?i.scrollTop<=t.value+n-i.scrollHeight+1:i.scrollTop<=t.value/100+n-i.scrollHeight+1},l.prototype.isElementAtBottom=function(i,s){s===void 0&&(s=.8);var n=i===document.body||i===document.documentElement?window.screen.availHeight:i.clientHeight,t=K(s);return t.unit===_.Pixel?i.scrollTop+n>=i.scrollHeight-t.value:i.scrollTop+n>=t.value/100*i.scrollHeight},l.prototype.render=function(){var i=this,s=R({height:this.props.height||"auto",overflow:"auto",WebkitOverflowScrolling:"touch"},this.props.style),n=this.props.hasChildren||!!(this.props.children&&this.props.children instanceof Array&&this.props.children.length),t=this.props.pullDownToRefresh&&this.props.height?{overflow:"auto"}:{};return I.createElement("div",{style:t,className:"infinite-scroll-component__outerdiv"},I.createElement("div",{className:"infinite-scroll-component "+(this.props.className||""),ref:function(d){return i._infScroll=d},style:s},this.props.pullDownToRefresh&&I.createElement("div",{style:{position:"relative"},ref:function(d){return i._pullDown=d}},I.createElement("div",{style:{position:"absolute",left:0,right:0,top:-1*this.maxPullDownDistance}},this.state.pullToRefreshThresholdBreached?this.props.releaseToRefreshContent:this.props.pullDownToRefreshContent)),this.props.children,!this.state.showLoader&&!n&&this.props.hasMore&&this.props.loader,this.state.showLoader&&this.props.hasMore&&this.props.loader,!this.props.hasMore&&this.props.endMessage))},l})(c.Component);const ce=({selectedId:e,onSelectContact:l,isLoadingContact:i,colorMap:s,allUsers:n,allContacts:t,setAllContacts:d})=>{const[f,m]=c.useState(!1),[a,u]=c.useState(!1),[o,j]=c.useState(null),{getSelectedUsers:T,selectedUsers:N,isLoadingDelete:p,deleteUser:E,usersTotalCount:h=0}=H(S=>S),[x,y]=c.useState({search:"",page:1,limit:10,hasMore:!0});c.useEffect(()=>{D(1)},[x.search]),c.useEffect(()=>{N&&d(S=>x.page===1?N:[...S,...N])},[N]),c.useEffect(()=>{y(S=>({...S,hasMore:(t==null?void 0:t.length)<h}))},[t,h]);const D=(S=1)=>{T({search:x.search,page:S,limit:x.limit}),y(b=>({...b,page:S}))},g=()=>{!x.hasMore||i||D(x.page+1)},v=S=>{const b=S.target.value;d([]),y({search:b,page:1,limit:10,hasMore:!0})},w=S=>{u(!0),j(S)},M=()=>{o!=null&&o.id&&E({id:o.id},()=>{u(!1),j(null),D(1)})};return r.jsxs(r.Fragment,{children:[r.jsxs("div",{className:"message-left-wrap",children:[r.jsxs("div",{className:"head",children:[r.jsx(C,{hideFilter:!0,hideRightSide:!0}),r.jsx("div",{className:"icon cursor-pointer",onClick:()=>m(!0),children:r.jsx("img",{src:ne,alt:"plus"})})]}),r.jsxs("div",{className:"msg-listing-wrap",id:"scrollableDiv",children:[r.jsx("div",{className:"search",children:r.jsx("input",{type:"text",className:"txt",placeholder:"Search messages",value:x.search,onChange:v})}),i&&x.page===1?Array.from({length:7}).map((S,b)=>r.jsx(P,{height:50},b)):(t==null?void 0:t.length)===0?r.jsx("li",{style:{listStyleType:"none"},className:"text-center",children:"No users found."}):r.jsx(z,{dataLength:t.length,next:g,hasMore:x.hasMore,loader:Array.from({length:5}).map((S,b)=>r.jsx(P,{height:50},b)),scrollableTarget:"scrollableDiv",children:r.jsx("ul",{className:"listing",children:t==null?void 0:t.map(S=>r.jsx(ge,{contact:S,selectedId:e,onSelectContact:l,colorMap:s,onDelete:w},S.id))})})]})]}),r.jsx(me,{showModal:f,closeModal:()=>m(!1),contacts:n,selectedUsers:t,onAdded:()=>D(1),colorMap:s}),a&&r.jsx(ee,{isDelete:!0,isLoading:p,showModal:a,closeModal:()=>u(!1),message:`Are you sure you want to delete the conversation with ${o==null?void 0:o.name}?`,onCancel:()=>u(!1),onSubmit:M})]})},ve="data:image/svg+xml,%3csvg%20width='20'%20height='19'%20viewBox='0%200%2020%2019'%20fill='none'%20xmlns='http://www.w3.org/2000/svg'%3e%3cpath%20d='M14.1391%200.460043L5.10914%203.46004C-0.960859%205.49004%20-0.960859%208.80004%205.10914%2010.82L7.78914%2011.71L8.67914%2014.39C10.6991%2020.46%2014.0191%2020.46%2016.0391%2014.39L19.0491%205.37004C20.3891%201.32004%2018.1891%20-0.889957%2014.1391%200.460043ZM14.4591%205.84004L10.6591%209.66004C10.5091%209.81004%2010.3191%209.88004%2010.1291%209.88004C9.93914%209.88004%209.74914%209.81004%209.59914%209.66004C9.45966%209.5189%209.38144%209.32847%209.38144%209.13004C9.38144%208.93161%209.45966%208.74118%209.59914%208.60004L13.3991%204.78004C13.6891%204.49004%2014.1691%204.49004%2014.4591%204.78004C14.7491%205.07004%2014.7491%205.55004%2014.4591%205.84004Z'%20fill='%23051a53'/%3e%3c/svg%3e",xe=({message:e,setMessage:l,onSend:i,isLoadingPostMessage:s})=>r.jsxs("div",{className:"footer-wrap",children:[r.jsx("input",{type:"text",className:"text",placeholder:"Type a message",value:e,onChange:n=>l(n.target.value),onKeyDown:n=>n.key==="Enter"&&i(),disabled:s}),s?r.jsx(Y,{size:"sm",as:"span",animation:"border",variant:"info","aria-hidden":"true",className:"custom-spinner"}):r.jsx("img",{src:ve,alt:"",className:`img ${s?"disabled":""}`,onClick:i,disabled:s})]}),ye=({selectedContact:e,message:l,setMessage:i,onSend:s,colorMap:n,isLoadingContact:t,newMessage:d})=>{const{isLoadingPostMessage:f,GetMessageById:m,messageIdData:a,loadingMessageById:u}=H(g=>g),[o,j]=c.useState(1),[T,N]=c.useState(!0),[p,E]=c.useState([]),h=c.useRef(null);c.useEffect(()=>{var g;if(((g=e==null?void 0:e.messages)==null?void 0:g.length)>0){const v=[...e.messages].sort((w,M)=>new Date(w.createdAt)-new Date(M.createdAt));E(v),j(1),N(!0)}else E([])},[e==null?void 0:e.id]),c.useEffect(()=>{!d||!d.id||E(g=>g.some(w=>w.id===d.id)?g:[...g,d])},[d]),c.useEffect(()=>{if(Array.isArray(a)&&a.length>0){const g=[...p];a.forEach(v=>{(g==null?void 0:g.some(M=>M.id===v.id))||g.unshift(v)}),g.sort((v,w)=>new Date(v.createdAt)-new Date(w.createdAt)),E(g)}},[a]);const x=async()=>{const g=p==null?void 0:p[0];if(!(e!=null&&e.id)||!(g!=null&&g.id))return;const v=await m(e.id,{page:o+1,limit:10,beforeMessageId:g.id});Array.isArray(v)&&(v.length<10&&N(!1),E(w=>[...v,...w]),j(w=>w+1))};c.useEffect(()=>{!d||!d.id||(E(g=>g.some(w=>w.id===d.id)?g:[...g,d]),setTimeout(()=>{h.current&&(h.current.scrollTop=h.current.scrollHeight)},100))},[d]);const y=()=>e!=null&&e.img?r.jsx("img",{src:e==null?void 0:e.img,alt:e==null?void 0:e.name}):r.jsx(B,{name:(e==null?void 0:e.name)||"User",uniqueKey:e==null?void 0:e.id,colorClass:n==null?void 0:n[e==null?void 0:e.id]}),D=(p==null?void 0:p.length)>8?{overflow:"auto",display:"flex",flexDirection:"column-reverse"}:{};return r.jsxs("div",{className:"message-content-wrap",children:[t?r.jsx("div",{className:"d-flex justify-content-center align-items-center h-100",children:r.jsx(Y,{as:"span",animation:"border",variant:"info","aria-hidden":"true",className:"custom-spinner"})}):e!=null&&e.name&&(e==null?void 0:e.name)!=="Unknown"?r.jsxs("div",{className:"head-wrap",children:[r.jsx("figure",{className:"img",children:r.jsx(B,{name:e==null?void 0:e.name,uniqueKey:e==null?void 0:e.id,colorClass:n==null?void 0:n[e==null?void 0:e.id]})}),r.jsxs("div",{className:"name-status-wrap",children:[r.jsx("div",{className:"name",children:e==null?void 0:e.name}),r.jsx("div",{className:"status online",children:"Online"})]})]}):null,r.jsx("div",{id:"scrollableDivMessage",ref:h,className:"body-msg-wrap",style:D,children:t?r.jsx(P,{}):e?(p==null?void 0:p.length)>0?r.jsx(z,{dataLength:p==null?void 0:p.length,next:x,hasMore:T,inverse:!0,loader:u&&r.jsx("div",{className:"d-flex justify-content-center py-3",children:r.jsx(Y,{as:"span",animation:"border",variant:"info",className:"custom-spinner"})}),scrollableTarget:"scrollableDivMessage",children:p==null?void 0:p.map((g,v)=>{var S;const w=new Date(g.createdAt),M=v===0||!O(new Date((S=p[v-1])==null?void 0:S.createdAt),w);return r.jsxs(I.Fragment,{children:[M&&r.jsx("div",{className:"date-wrap",children:r.jsx("span",{children:ie(w)?"Today":re(w)?"Yesterday":G(w,"eeee, MMM d, yyyy")})}),r.jsxs("div",{className:`chat-block ${g.senderType===1?"chat-block-right":""}`,children:[g.senderType!==1&&y(),r.jsxs("div",{className:"chat-content-wrap",children:[r.jsx("p",{className:"txt",children:g.message}),r.jsx("div",{className:"time",children:G(w,"hh:mm a")})]})]})]},g.id||v)})}):r.jsx("div",{className:"no-messages text-center mt-5",children:"No messages yet."}):r.jsx("div",{className:"no-messages text-center mt-5",children:"No messages yet. Pick a user to start chatting!"})}),(e==null?void 0:e.name)&&(e==null?void 0:e.name)!=="Unknown"&&r.jsx(xe,{message:l,setMessage:i,onSend:s,isLoadingPostMessage:f})]})},Se=()=>{const{getSelectedUsers:e,getAllContacts:l,contacts:i,isLoadingContact:s,postMessage:n}=H(y=>y),[t,d]=c.useState(null),[f,m]=c.useState(""),[a,u]=c.useState([]),[o,j]=c.useState(null),T=()=>{e({search:"",page:1,limit:10})},N=Array.isArray(i)?i:[],p=a==null?void 0:a.find(y=>(y==null?void 0:y.id)===t),E=c.useMemo(()=>{var y,D;return((D=(y=p==null?void 0:p.messages)==null?void 0:y.map(g=>({from:g.senderType===1?"me":"them",text:g.message,time:g.createdAt})))==null?void 0:D.sort((g,v)=>new Date(g.time)-new Date(v.time)))||[]},[p]),h=c.useMemo(()=>{const y={};return a==null||a.forEach(D=>{D!=null&&D.id&&(y[D.id]=se(D.id))}),y},[a]),x=()=>{if(!(f!=null&&f.trim())||!t||!(p!=null&&p.id))return;const y=f.trim(),D={id:crypto.randomUUID(),senderType:1,message:y,createdAt:new Date().toISOString()};u(g=>g.map(v=>v.id===t?{...v,messages:[...v.messages||[],D]}:v)),j(D),m(""),n({conversationId:p==null?void 0:p.id,message:y},()=>{T()},g=>{console.error("Failed to send:",g),m(y)})};return c.useEffect(()=>{l(),T()},[]),r.jsxs("div",{className:"message-body-wrap",children:[r.jsx(ce,{isLoadingContact:s,selectedId:t,onSelectContact:d,refreshContacts:T,colorMap:h,allUsers:N,allContacts:a,setAllContacts:u}),r.jsx(ye,{isLoadingContact:s,selectedContact:p,messages:E,message:f,setMessage:m,onSend:x,colorMap:h,newMessage:o})]})};export{Se as default};
